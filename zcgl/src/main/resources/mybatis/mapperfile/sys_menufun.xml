<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="confing/mappers.sys_menufun">
    <resultMap id="BaseResultMap" type="com.hz.demo.model.sys_menufun">
        <id column="menu_fun_id" jdbcType="VARCHAR" property="menuFunId"/>
        <result column="menu_id" jdbcType="VARCHAR" property="menuId"/>
        <result column="btn_code" jdbcType="VARCHAR" property="btnCode"/>
        <result column="btn_name" jdbcType="VARCHAR" property="btnName"/>
        <result column="state" jdbcType="INTEGER" property="state"/>
        <result column="fsort" jdbcType="INTEGER" property="fsort"/>
    </resultMap>
    <sql id="Base_Column_List">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Tue May 08 09:26:48 CST 2018.
        -->
        menu_fun_id, menu_id, btn_code,btn_name,state,fsort
    </sql>
    <select id="selectByPrimaryKey" parameterType="java.lang.String" resultMap="BaseResultMap">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Tue May 08 09:26:48 CST 2018.
        -->
        select
        <include refid="Base_Column_List"/>
        from sys_menufun
        where menu_fun_id = #{menuFunId,jdbcType=VARCHAR}
    </select>
    <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Tue May 08 09:26:48 CST 2018.
        -->
        delete from sys_menufun
        where menu_fun_id = #{menuFunId,jdbcType=VARCHAR}
    </delete>
    <insert id="insert" parameterType="com.hz.demo.model.sys_menufun">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Tue May 08 09:26:48 CST 2018.
        -->
        insert into sys_menufun (menu_fun_id, menu_id, btn_code,btn_name,state
        )
        values (#{menuFunId,jdbcType=VARCHAR}, #{menuId,jdbcType=VARCHAR},
        #{btnCode,jdbcType=VARCHAR},#{btnName,jdbcType=VARCHAR},#{state,jdbcType=INTEGER},#{fsort,jdbcType=INTEGER}
        )
    </insert>
    <insert id="insertSelective" parameterType="com.hz.demo.model.sys_menufun">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Tue May 08 09:26:48 CST 2018.
        -->
        insert into sys_menufun
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="menuFunId != null">
                menu_fun_id,
            </if>
            <if test="menuId != null">
                menu_id,
            </if>
            <if test="btnCode != null">
                btn_code,
            </if>
            <if test="btnName != null">
                btn_name,
            </if>
            <if test="state != null">
                state,
            </if>
            <if test="fsort != null">
                fsort,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="menuFunId != null">
                #{menuFunId,jdbcType=VARCHAR},
            </if>
            <if test="menuId != null">
                #{menuId,jdbcType=VARCHAR},
            </if>
            <if test="btnCode != null">
                #{btnCode,jdbcType=VARCHAR},
            </if>
            <if test="btnName != null">
                #{btnName,jdbcType=VARCHAR},
            </if>
            <if test="state != null">
                #{state,jdbcType=INTEGER},
            </if>
            <if test="fsort != null">
                #{fsort,jdbcType=INTEGER},
            </if>
        </trim>
    </insert>
    <update id="updateByPrimaryKeySelective" parameterType="com.hz.demo.model.sys_menufun">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Tue May 08 09:26:48 CST 2018.
        -->
        update sys_menufun
        <set>
            <if test="menuId != null">
                menu_id = #{menuId,jdbcType=VARCHAR},
            </if>
            <if test="btnCode != null">
                btn_code = #{btnCode,jdbcType=VARCHAR},
            </if>
            <if test="btnName != null">
                btn_name = #{btnName,jdbcType=VARCHAR},
            </if>
            <if test="state != null">
                state = #{state,jdbcType=INTEGER},
            </if>
            <if test="fsort != null">
                fsort = #{fsort,jdbcType=INTEGER},
            </if>
        </set>
        where menu_fun_id = #{menuFunId,jdbcType=VARCHAR}
    </update>
    <update id="updateByPrimaryKey" parameterType="com.hz.demo.model.sys_menufun">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Tue May 08 09:26:48 CST 2018.
        -->
        update sys_menufun
        set menu_id = #{menuId,jdbcType=VARCHAR},
        btn_code = #{btnCode,jdbcType=VARCHAR},btn_name = #{btnName,jdbcType=VARCHAR},
        state = #{state,jdbcType=INTEGER},fsort = #{fsort,jdbcType=INTEGER}
        where menu_fun_id = #{menuFunId,jdbcType=VARCHAR}
    </update>


    <!--获取所有菜单按钮列表 -->
    <select id="GetListByMenuID" parameterType="pd" resultType="Map">
 SELECT <include refid="Base_Column_List"/> from sys_menufun where menu_id = #{menuId} ORDER BY fsort
  </select>

    <!--获取角色权限树 -->
    <select id="GetRoleTree" parameterType="pd" resultType="Map">
        SELECT
        *
        FROM
        (
        SELECT
       (smf.menu_fun_id ||
        '|' || sm.menu_id ||
        '|' ||
        smf.menu_fun_id) AS id,
        smf.btn_name AS text,
        sm.menu_id AS pid,
        (
        SELECT
        to_char(count(*))
        FROM
        sys_rolemenufun t
        WHERE
        t.menu_fun_id = smf.menu_fun_id
        AND t.role_id = #{roleId}
        ) AS checked,
       ('0'|| '|'|| '0') AS attributes
        FROM
        Sys_Menu sm,
        Sys_MenuFun smf
        WHERE
        sm.menu_id = smf.menu_id
            and smf.state='1'
            ORDER BY smf.fsort
        ) btn
        UNION ALL
        SELECT
      *
        FROM
        (
        SELECT
        sm.menu_id AS id,
        sm.menu_name AS text,
        sm.parent_id AS pid,
        '0' AS checked,
        ('0'|| '|'|| '1') AS attributes
        FROM
        Sys_Menu sm
        ORDER BY
        sm.fsort
        ) menu
    </select>


    <!--根据当前登录用户获取当前某一个菜单按钮权限 -->
    <select id="GetMenuFun" parameterType="pd" resultType="Map">
SELECT
	smf.btn_code as btnCode
FROM
	sys_menu sm,
	sys_menufun smf,
	sys_userrole sur,
	sys_rolemenufun srmf
WHERE sm.menu_id = smf.menu_id
	AND sur.role_id = srmf.role_id
	AND srmf.menu_fun_id = smf.menu_fun_id
	AND sm.menu_id = #{MenuId}
	AND sur.user_id = #{UserId}
    AND smf.state='1'
    </select>
    <!--根据当前登录专家获取当前某一个菜单按钮权限 -->
    <select id="GetMenuFunTwo" parameterType="pd" resultType="Map">
      SELECT
            smf.btn_code AS btnCode
        FROM
            sys_menu sm,
            sys_menufun smf
        WHERE
            sm.menu_id = smf.menu_id
            AND sm.menu_id = #{MenuId}
            AND smf.state = '1'
    </select>

</mapper>