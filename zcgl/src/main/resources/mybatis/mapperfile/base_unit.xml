<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="confing/mappers.base_unit">
  <resultMap id="BaseResultMap" type="com.hz.demo.model.base_unit">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Sep 04 11:25:42 CST 2018.
    -->
    <id column="ID" jdbcType="INTEGER" property="bid" />
    <result column="UNIT_CODE" jdbcType="VARCHAR" property="unitCode" />
    <result column="ORGANIZATION_CODE" jdbcType="VARCHAR" property="organizationCode" />
    <result column="CREDIT_CODE" jdbcType="VARCHAR" property="creditCode" />
    <result column="UNIT_NAME" jdbcType="VARCHAR" property="unitName" />
    <result column="UNIT_ATTACH" jdbcType="VARCHAR" property="unitAttach" />
    <result column="UNIT_CATEGORY" jdbcType="VARCHAR" property="unitCategory" />
    <result column="INDUSTRY_INVOLVED" jdbcType="VARCHAR" property="industryInvolved" />
    <result column="UNIT_NATURE" jdbcType="VARCHAR" property="unitNature" />
    <result column="ECONOMIC_TYPE" jdbcType="VARCHAR" property="economicType" />
    <result column="AREA_NUMBER" jdbcType="VARCHAR" property="areaNumber" />
    <result column="LIKEMAN" jdbcType="VARCHAR" property="linkMan" />
    <result column="PHONE" jdbcType="VARCHAR" property="phone" />
    <result column="ADDRESS" jdbcType="VARCHAR" property="address" />
    <result column="FAX" jdbcType="VARCHAR" property="fax" />
    <result column="EMAIL" jdbcType="VARCHAR" property="email" />
    <result column="POSTAL_CODE" jdbcType="VARCHAR" property="postalCode" />
    <result column="ADDTIME" jdbcType="TIMESTAMP" property="addTime" />
    <result column="ADDUSERID" jdbcType="VARCHAR" property="addUserId" />
    <result column="STATE" jdbcType="INTEGER" property="state" />
    <result column="PARENTUNIT_CODE" jdbcType="VARCHAR" property="parentUnitCode" />
    <result column="IS_BUILDJUDGING" jdbcType="INTEGER" property="isBuildjudging" />
    <result column="IS_MANAGEUNIT" jdbcType="INTEGER" property="isManageunit" />
    <result column="IS_FIRMLYORGANIZATION" jdbcType="INTEGER" property="isFirmlyorganization" />
    <result column="IS_DELETE" jdbcType="INTEGER" property="isDelete" />
    <result column="BACK1" jdbcType="VARCHAR" property="back1" />
    <result column="BACK2" jdbcType="VARCHAR" property="back2" />
    <result column="BACK3" jdbcType="VARCHAR" property="back3" />
  </resultMap>
  <resultMap id="TreeResultMap" type="com.hz.demo.core.Tree">
    <result column="UNIT_CODE" jdbcType="VARCHAR" property="id" />
    <result column="UNIT_NAME" jdbcType="VARCHAR" property="text" />
    <result column="PARENTUNIT_CODE" jdbcType="VARCHAR" property="pid" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Sep 04 11:25:42 CST 2018.
    -->
    ID, UNIT_CODE, ORGANIZATION_CODE, CREDIT_CODE, UNIT_NAME, UNIT_ATTACH, UNIT_CATEGORY, 
    INDUSTRY_INVOLVED, UNIT_NATURE, ECONOMIC_TYPE, AREA_NUMBER, LIKEMAN, PHONE, ADDRESS, BACK1,BACK2,BACK3,
    FAX, EMAIL, POSTAL_CODE, ADDTIME, ADDUSERID, STATE, PARENTUNIT_CODE, IS_BUILDJUDGING, IS_MANAGEUNIT, IS_FIRMLYORGANIZATION
  </sql>
  <select id="getBaseUnitForId" parameterType="Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Sep 04 11:25:42 CST 2018.
    -->
    select 
    <include refid="Base_Column_List" />
    from BASE_UNIT
    where ID = #{bid}
  </select>
  <delete id="deleteBaseUnitByFid" parameterType="Integer">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Sep 04 11:25:42 CST 2018.
    -->
    delete from BASE_UNIT
    where ID = #{bid}
  </delete>
  <insert id="insert" parameterType="com.hz.demo.core.PageData">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Sep 04 11:25:42 CST 2018.
    -->
    insert into BASE_UNIT (ID, UNIT_CODE, ORGANIZATION_CODE, 
      CREDIT_CODE, UNIT_NAME, UNIT_ATTACH, 
      UNIT_CATEGORY, INDUSTRY_INVOLVED, UNIT_NATURE, 
      ECONOMIC_TYPE, AREA_NUMBER, LIKEMAN, 
      PHONE, ADDRESS, FAX, 
      EMAIL, POSTAL_CODE, ADDTIME, 
      ADDUSERID, STATE, PARENTUNIT_CODE
      )
    values (SEQ_BASE_UNIT.nextval, #{unitCode,jdbcType=VARCHAR}, #{organizationCode,jdbcType=VARCHAR},
      #{creditCode,jdbcType=VARCHAR}, #{unitName,jdbcType=VARCHAR}, #{unitAttach,jdbcType=VARCHAR}, 
      #{unitCategory,jdbcType=VARCHAR}, #{industryInvolved,jdbcType=VARCHAR}, #{unitNature,jdbcType=VARCHAR}, 
      #{economicType,jdbcType=VARCHAR}, #{areaNumber,jdbcType=VARCHAR}, #{linkMan,jdbcType=VARCHAR},
      #{phone,jdbcType=VARCHAR}, #{address,jdbcType=VARCHAR}, #{fax,jdbcType=VARCHAR}, 
      #{email,jdbcType=VARCHAR}, #{postalCode,jdbcType=VARCHAR}, #{addTime,jdbcType=TIMESTAMP},
      #{addUserId,jdbcType=VARCHAR}, #{state,jdbcType=INTEGER}, #{parentUnitCode,jdbcType=VARCHAR}

      )
  </insert>
  <insert id="insertSelective" parameterType="com.hz.demo.model.base_unit">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Sep 04 11:25:42 CST 2018.
    -->
    insert into BASE_UNIT
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="bid != null">
        ID,
      </if>
      <if test="unitCode != null">
        UNIT_CODE,
      </if>
      <if test="organizationCode != null">
        ORGANIZATION_CODE,
      </if>
      <if test="creditCode != null">
        CREDIT_CODE,
      </if>
      <if test="unitName != null">
        UNIT_NAME,
      </if>
      <if test="unitAttach != null">
        UNIT_ATTACH,
      </if>
      <if test="unitCategory != null">
        UNIT_CATEGORY,
      </if>
      <if test="industryInvolved != null">
        INDUSTRY_INVOLVED,
      </if>
      <if test="unitNature != null">
        UNIT_NATURE,
      </if>
      <if test="economicType != null">
        ECONOMIC_TYPE,
      </if>
      <if test="areaNumber != null">
        AREA_NUMBER,
      </if>
      <if test="linkMan != null">
        LIKEMAN,
      </if>
      <if test="phone != null">
        PHONE,
      </if>
      <if test="address != null">
        ADDRESS,
      </if>
      <if test="fax != null">
        FAX,
      </if>
      <if test="email != null">
        EMAIL,
      </if>
      <if test="postalCode != null">
        POSTAL_CODE,
      </if>
      <if test="addTime != null">
        ADDTIME,
      </if>
      <if test="addUserId != null">
        ADDUSERID,
      </if>
      <if test="state != null">
        STATE,
      </if>
      <if test="parentUnitCode != null">
        PARENTUNIT_CODE,
      </if>

    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="bid != null">
        #{bid,jdbcType=INTEGER},
      </if>
      <if test="unitCode != null">
        #{unitCode,jdbcType=VARCHAR},
      </if>
      <if test="organizationCode != null">
        #{organizationCode,jdbcType=VARCHAR},
      </if>
      <if test="creditCode != null">
        #{creditCode,jdbcType=VARCHAR},
      </if>
      <if test="unitName != null">
        #{unitName,jdbcType=VARCHAR},
      </if>
      <if test="unitAttach != null">
        #{unitAttach,jdbcType=VARCHAR},
      </if>
      <if test="unitCategory != null">
        #{unitCategory,jdbcType=VARCHAR},
      </if>
      <if test="industryInvolved != null">
        #{industryInvolved,jdbcType=VARCHAR},
      </if>
      <if test="unitNature != null">
        #{unitNature,jdbcType=VARCHAR},
      </if>
      <if test="economicType != null">
        #{economicType,jdbcType=VARCHAR},
      </if>
      <if test="areaNumber != null">
        #{areaNumber,jdbcType=VARCHAR},
      </if>
      <if test="linkMan != null">
        #{linkMan,jdbcType=VARCHAR},
      </if>
      <if test="phone != null">
        #{phone,jdbcType=VARCHAR},
      </if>
      <if test="address != null">
        #{address,jdbcType=VARCHAR},
      </if>
      <if test="fax != null">
        #{fax,jdbcType=VARCHAR},
      </if>
      <if test="email != null">
        #{email,jdbcType=VARCHAR},
      </if>
      <if test="postalCode != null">
        #{postalCode,jdbcType=VARCHAR},
      </if>
      <if test="addTime != null">
        #{addTime,jdbcType=TIMESTAMP},
      </if>
      <if test="addUserId != null">
        #{addUserId,jdbcType=VARCHAR},
      </if>
      <if test="state != null">
        #{state,jdbcType=INTEGER},
      </if>
      <if test="parentUnitCode != null">
        #{parentUnitCode,jdbcType=VARCHAR},
      </if>

    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="pd">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Sep 04 11:25:42 CST 2018.
    -->
    update BASE_UNIT
    <set>
      <if test="unitCode != null">
        UNIT_CODE = #{unitCode,jdbcType=VARCHAR},
      </if>
      <if test="organizationCode != null">
        ORGANIZATION_CODE = #{organizationCode,jdbcType=VARCHAR},
      </if>
      <if test="creditCode != null">
        CREDIT_CODE = #{creditCode,jdbcType=VARCHAR},
      </if>
      <if test="unitName != null">
        UNIT_NAME = #{unitName,jdbcType=VARCHAR},
      </if>
      <if test="unitAttach != null">
        UNIT_ATTACH = #{unitAttach,jdbcType=VARCHAR},
      </if>
      <if test="unitCategory != null">
        UNIT_CATEGORY = #{unitCategory,jdbcType=VARCHAR},
      </if>
      <if test="industryInvolved != null">
        INDUSTRY_INVOLVED = #{industryInvolved,jdbcType=VARCHAR},
      </if>
      <if test="unitNature != null">
        UNIT_NATURE = #{unitNature,jdbcType=VARCHAR},
      </if>
      <if test="economicType != null">
        ECONOMIC_TYPE = #{economicType,jdbcType=VARCHAR},
      </if>
      <if test="areaNumber != null">
        AREA_NUMBER = #{areaNumber,jdbcType=VARCHAR},
      </if>
      <if test="linkMan != null">
        LIKEMAN = #{linkMan,jdbcType=VARCHAR},
      </if>
      <if test="phone != null">
        PHONE = #{phone,jdbcType=VARCHAR},
      </if>
      <if test="address != null">
        ADDRESS = #{address,jdbcType=VARCHAR},
      </if>
      <if test="fax != null">
        FAX = #{fax,jdbcType=VARCHAR},
      </if>
      <if test="email != null">
        EMAIL = #{email,jdbcType=VARCHAR},
      </if>
      <if test="postalCode != null">
        POSTAL_CODE = #{postalCode,jdbcType=VARCHAR},
      </if>
      <if test="addTime != null">
        ADDTIME = #{addTime,jdbcType=TIMESTAMP},
      </if>
      <if test="addUserId != null">
        ADDUSERID = #{addUserId,jdbcType=VARCHAR},
      </if>
      <if test="state != null">
        STATE = #{state},
      </if>
      <if test="parentUnitCode != null">
        PARENTUNIT_CODE = #{parentUnitCode},
      </if>
      <if test="isBuildjudging != null">
        IS_BUILDJUDGING = #{isBuildjudging},
      </if>
      <if test="isManageunit != null">
        IS_MANAGEUNIT = #{isManageunit},
      </if>
      <if test="isFirmlyorganization != null">
        IS_FIRMLYORGANIZATION = #{isFirmlyorganization},
      </if>
      <if test="isDelete != null">
        IS_DELETE = #{isDelete},
      </if>
      <if test="back1 != null">
        BACK1 = #{back1},
      </if>
      <if test="back2 != null">
        BACK2 = #{back2},
      </if>
      <if test="back3 != null">
        BACK3 = #{back3},
      </if>
    </set>
    where ID = #{bid}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.hz.demo.model.base_unit">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Sep 04 11:25:42 CST 2018.
    -->
    update BASE_UNIT
    set UNIT_CODE = #{unitCode,jdbcType=VARCHAR},
      ORGANIZATION_CODE = #{organizationCode,jdbcType=VARCHAR},
      CREDIT_CODE = #{creditCode,jdbcType=VARCHAR},
      UNIT_NAME = #{unitName,jdbcType=VARCHAR},
      UNIT_ATTACH = #{unitAttach,jdbcType=VARCHAR},
      UNIT_CATEGORY = #{unitCategory,jdbcType=VARCHAR},
      INDUSTRY_INVOLVED = #{industryInvolved,jdbcType=VARCHAR},
      UNIT_NATURE = #{unitNature,jdbcType=VARCHAR},
      ECONOMIC_TYPE = #{economicType,jdbcType=VARCHAR},
      AREA_NUMBER = #{areaNumber,jdbcType=VARCHAR},
      LIKEMAN = #{linkMan,jdbcType=VARCHAR},
      PHONE = #{phone,jdbcType=VARCHAR},
      ADDRESS = #{address,jdbcType=VARCHAR},
      FAX = #{fax,jdbcType=VARCHAR},
      EMAIL = #{email,jdbcType=VARCHAR},
      POSTAL_CODE = #{postalCode,jdbcType=VARCHAR},
      ADDTIME = #{addTime,jdbcType=TIMESTAMP},
      ADDUSERID = #{addUserId,jdbcType=VARCHAR},
      STATE = #{state,jdbcType=INTEGER},
      PARENTUNIT_CODE = #{parentUnitCode,jdbcType=VARCHAR}
    where ID = #{bid}
  </update>

  <!--根据条件查询全部记录-->
  <select id="getAllBaseUnit" parameterType="pd" resultMap="BaseResultMap">

    select <include refid="Base_Column_List"/>
    from
    (select rownum rn,e.* from
    (
    select a.* from base_unit a WHERE a.PARENTUNIT_CODE = #{unitCode} AND a.IS_DELETE = 0
    <if test="unitName != null and unitName !=''">
      and unit_name like '%'||#{unitName}||'%'
    </if>
    ORDER by unit_category,unit_code) e
    <if test="page != null and rows != null">
      where rownum &lt;=#{rows}*#{page}) b
      where  rn>(#{page}-1)*#{rows}
    </if>
  </select>

  <!--根据条件查询全部记录个数-->
  <select id="selectCount" parameterType="pd" resultType="Integer">
    select count(*) as listcount from base_unit  WHERE PARENTUNIT_CODE = #{unitCode} AND IS_DELETE = 0
    <if test="unitName != null and unitName !=''">
      and unit_name like '%'||#{unitName}||'%'
    </if>
  </select>

  <!-- 根据机构类别,行政区化代码生成新的机构unitcode-->
  <!-- 首先获取当前条件下最大编码-->
  <select id="selectUnitCode" parameterType="pd" resultType="String">
    select max(unit_code) from base_unit where LENGTH(unit_code) = #{unitCodelength} and unit_code like #{unitCode}||'%'
  </select>


  <!--根据条件查询记录-->
  <select id="getModelWhere" parameterType="pd" resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List"/>
    from base_unit
    where  IS_DELETE = 0
    <if test="unitCode != null">
      and UNIT_CODE = #{unitCode}
    </if>
    <if test="unitName != null">
      AND UNIT_NAME = #{unitName}
    </if>
  </select>

  <!--根据条件查询全部机构-->
  <select id="selectListWhere" parameterType="pd" resultType="Map">

    SELECT unit_code as id,unit_name as text,parentunit_code as pid  FROM
        base_unit where IS_DELETE = 0
        ORDER BY addtime desc
  </select>
  <!--根据条件查询实体-->
  <select id="getUnitWhere" parameterType="pd" resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List" />
    from base_unit
    where unit_code = #{unitCode,jdbcType=VARCHAR}
  </select>

  <select id="ybTree" resultType="pd" parameterType="pd">
    <if test="pid==''">
       select PARENTUNIT_CODE pid,unit_code id,unit_name text from base_unit where unit_code=#{unitCode} and IS_DELETE = 0
       union all
       select PARENTUNIT_CODE pid,unit_code id,unit_name text from base_unit where PARENTUNIT_CODE=#{unitCode} and IS_DELETE = 0
    </if>
    <if test="pid != '' and pid != null">
      select PARENTUNIT_CODE pid,unit_code id,unit_name text from base_unit where PARENTUNIT_CODE=#{pid} and IS_DELETE = 0
    </if>
  </select>

  <select id="getSuperUnit" resultMap="BaseResultMap" parameterType="java.lang.String">
    select <include refid="Base_Column_List"/> from BASE_UNIT
    where UNIT_CODE=#{parentunitCode,jdbcType=VARCHAR}  and IS_DELETE = 0
  </select>

  <select id="ybTreeSize" resultType="java.lang.Integer" parameterType="java.lang.String">

      select count(*) from base_unit where PARENTUNIT_CODE=#{pid} and IS_DELETE = 0

  </select>

  <select id="getGroupTreeList" resultType="Map" parameterType="pd">

    select BSGR.id,BSGR.GROUP_NAME text  from BASE_SUBJECT_GROUP  bsgr
    <if test="SPECIALITY_ID!=null and SPECIALITY_ID!=''">
      LEFT JOIN BASE_SPECIALITY_GROUP bsg on bsg.group_id= bsgr.id
    </if>
    where 1=1
      <if test="JUDGING_CODE != null and JUDGING_CODE !=''">
          and bsgr.JUDGING_CODE=#{JUDGING_CODE}
      </if>
    <if test="SPECIALITY_ID!=null and SPECIALITY_ID!=''">
          and  bsg.SPECIALITY_ID=#{SPECIALITY_ID}
    </if>
    ORDER BY  bsgr.id DESC
  </select>
</mapper>