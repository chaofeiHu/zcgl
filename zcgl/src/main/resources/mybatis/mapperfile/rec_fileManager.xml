<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="confing/mappers.rec_fileManager">
  <resultMap id="BaseResultMap" type="com.hz.demo.model.rec_fileManager">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Nov 06 17:25:37 CST 2018.
    -->
    <id column="ID" jdbcType="DECIMAL" property="id" />
    <result column="FILE_CODE" jdbcType="VARCHAR" property="fileCode" />
    <result column="YEAR_NO" jdbcType="VARCHAR" property="yearNo" />
    <result column="FILE_TITLE" jdbcType="VARCHAR" property="fileTitle" />
    <result column="FILE_PATH" jdbcType="VARCHAR" property="filePath" />
    <result column="ADDTIME" jdbcType="TIMESTAMP" property="addtime" />
    <result column="BACK1" jdbcType="VARCHAR" property="back1" />
    <result column="BACK2" jdbcType="VARCHAR" property="back2" />
    <result column="BACK3" jdbcType="VARCHAR" property="back3" />
  </resultMap>

  <resultMap id="BaseResultMap1" type="com.hz.demo.model.rec_result">
    <id column="ID" jdbcType="DECIMAL" property="id" />
    <result column="YEAR_NO" jdbcType="VARCHAR" property="yearNo" />
    <result column="AREA_NAME" jdbcType="VARCHAR" property="areaCode" />
    <result column="JUDGING_NAME" jdbcType="VARCHAR" property="judgingCode" />
    <result column="GROUP_NAME" jdbcType="VARCHAR" property="groupId" />
    <result column="UNIT_NAME" jdbcType="VARCHAR" property="unitCode" />
    <result column="SERIES_NAME" jdbcType="VARCHAR" property="reviewSeries" />
    <result column="LEVEL_NAME" jdbcType="VARCHAR" property="titleLevel" />
    <result column="POSITIONAL_NAME" jdbcType="VARCHAR" property="positionalTitles" />
    <result column="PROFESSIAL_NAME" jdbcType="VARCHAR" property="professialCode" />
    <result column="REVIEW_TYPE_NAME" jdbcType="VARCHAR" property="reviewType" />
    <result column="USER_ID" jdbcType="VARCHAR" property="userId" />
    <result column="USER_NAME" jdbcType="VARCHAR" property="userName" />
    <result column="ID_CARD_NO" jdbcType="VARCHAR" property="idCardNo" />
    <result column="SEX" jdbcType="VARCHAR" property="sex" />
    <result column="GETTIME" jdbcType="TIMESTAMP" property="gettime" />
    <result column="GETWAY" jdbcType="VARCHAR" property="getway" />
    <result column="ADDTIME" jdbcType="TIMESTAMP" property="addtime" />
    <result column="BACK1" jdbcType="VARCHAR" property="back1" />
    <result column="AREA_GRADE" jdbcType="VARCHAR" property="back2" />
    <result column="PNAME" jdbcType="VARCHAR" property="back3" />
    <result column="ISBUILDCERTIFICATE" jdbcType="DECIMAL" property="isbuildcertificate" />
    <result column="ISBUILEFILE" jdbcType="DECIMAL" property="isbuilefile" />
    <result column="FILE_CODE" jdbcType="VARCHAR" property="fileCode" />
  </resultMap>

  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Nov 06 17:25:37 CST 2018.
    -->
    ID, FILE_CODE, YEAR_NO, FILE_TITLE, FILE_PATH, ADDTIME, BACK1, BACK2, BACK3
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.math.BigDecimal" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Nov 06 17:25:37 CST 2018.
    -->
    select 
    <include refid="Base_Column_List" />
    from REC_FILEMANAGER
    where ID = #{id,jdbcType=DECIMAL}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.math.BigDecimal">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Nov 06 17:25:37 CST 2018.
    -->
    delete from REC_FILEMANAGER
    where ID = #{id,jdbcType=DECIMAL}
  </delete>
  <insert id="insert" parameterType="com.hz.demo.model.rec_fileManager">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Nov 06 17:25:37 CST 2018.
    -->
    insert into REC_FILEMANAGER (ID, FILE_CODE, YEAR_NO, 
      FILE_TITLE, FILE_PATH, ADDTIME, 
      BACK1, BACK2, BACK3
      )
    values (#{id,jdbcType=DECIMAL}, #{fileCode,jdbcType=VARCHAR}, #{yearNo,jdbcType=VARCHAR}, 
      #{fileTitle,jdbcType=VARCHAR}, #{filePath,jdbcType=VARCHAR}, #{addtime,jdbcType=TIMESTAMP}, 
      #{back1,jdbcType=VARCHAR}, #{back2,jdbcType=VARCHAR}, #{back3,jdbcType=VARCHAR}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.hz.demo.model.rec_fileManager">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Nov 06 17:25:37 CST 2018.
    -->
    insert into REC_FILEMANAGER
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        ID,
      </if>
      <if test="fileCode != null">
        FILE_CODE,
      </if>
      <if test="yearNo != null">
        YEAR_NO,
      </if>
      <if test="fileTitle != null">
        FILE_TITLE,
      </if>
      <if test="filePath != null">
        FILE_PATH,
      </if>
      <if test="addtime != null">
        ADDTIME,
      </if>
      <if test="back1 != null">
        BACK1,
      </if>
      <if test="back2 != null">
        BACK2,
      </if>
      <if test="back3 != null">
        BACK3,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=DECIMAL},
      </if>
      <if test="fileCode != null">
        #{fileCode,jdbcType=VARCHAR},
      </if>
      <if test="yearNo != null">
        #{yearNo,jdbcType=VARCHAR},
      </if>
      <if test="fileTitle != null">
        #{fileTitle,jdbcType=VARCHAR},
      </if>
      <if test="filePath != null">
        #{filePath,jdbcType=VARCHAR},
      </if>
      <if test="addtime != null">
        #{addtime,jdbcType=TIMESTAMP},
      </if>
      <if test="back1 != null">
        #{back1,jdbcType=VARCHAR},
      </if>
      <if test="back2 != null">
        #{back2,jdbcType=VARCHAR},
      </if>
      <if test="back3 != null">
        #{back3,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.hz.demo.model.rec_fileManager">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Nov 06 17:25:37 CST 2018.
    -->
    update REC_FILEMANAGER
    <set>
      <if test="fileCode != null">
        FILE_CODE = #{fileCode,jdbcType=VARCHAR},
      </if>
      <if test="yearNo != null">
        YEAR_NO = #{yearNo,jdbcType=VARCHAR},
      </if>
      <if test="fileTitle != null">
        FILE_TITLE = #{fileTitle,jdbcType=VARCHAR},
      </if>
      <if test="filePath != null">
        FILE_PATH = #{filePath,jdbcType=VARCHAR},
      </if>
      <if test="addtime != null">
        ADDTIME = #{addtime,jdbcType=TIMESTAMP},
      </if>
      <if test="back1 != null">
        BACK1 = #{back1,jdbcType=VARCHAR},
      </if>
      <if test="back2 != null">
        BACK2 = #{back2,jdbcType=VARCHAR},
      </if>
      <if test="back3 != null">
        BACK3 = #{back3,jdbcType=VARCHAR},
      </if>
    </set>
    where ID = #{id,jdbcType=DECIMAL}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.hz.demo.model.rec_fileManager">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Nov 06 17:25:37 CST 2018.
    -->
    update REC_FILEMANAGER
    set FILE_CODE = #{fileCode,jdbcType=VARCHAR},
      YEAR_NO = #{yearNo,jdbcType=VARCHAR},
      FILE_TITLE = #{fileTitle,jdbcType=VARCHAR},
      FILE_PATH = #{filePath,jdbcType=VARCHAR},
      ADDTIME = #{addtime,jdbcType=TIMESTAMP},
      BACK1 = #{back1,jdbcType=VARCHAR},
      BACK2 = #{back2,jdbcType=VARCHAR},
      BACK3 = #{back3,jdbcType=VARCHAR}
    where ID = #{id,jdbcType=DECIMAL}
  </update>

  <!--评审结果(未生成文件)列表-->
  <select id="selectList" parameterType="pd" resultMap="BaseResultMap1">
    select *
    from
    (select rownum rn,e.* from
    (
    select t1.*,tb1.*,tb2.JUDGING_NAME,tb3.GROUP_NAME,tb4.UNIT_NAME,tb5.dict_name as SERIES_NAME,tb6.*,tb7.PROFESSIAL_NAME,tb8.DICT_NAME as REVIEW_TYPE_NAME
    from REC_RESULT t1
    left join
    (select tab1.AREA_CODE as AREA_NUMBER,tab1.AREA_NAME,tab1.AREA_GRADE,tab2.AREA_NAME as pname,tab2.AREA_GRADE as pgrade from SYS_AREA tab1
    left join sys_area tab2 on tab1.AREA_PARENTCODE = tab2.AREA_CODE) tb1 on t1.AREA_CODE = tb1.AREA_NUMBER
    left join BASE_JUDGING tb2 on t1.JUDGING_CODE = tb2.JUDGING_CODE
    left join BASE_SUBJECT_GROUP tb3 on tb3.id = t1.GROUP_ID
    left join BASE_UNIT tb4 on tb4.UNIT_CODE = t1.UNIT_CODE
    left join (select * from sys_dict where GROUP_NAME = 'REVIEW_SERIES') tb5 on tb5.DICT_CODE = t1.REVIEW_SERIES
    left join
    (select tab3.dict_code,tab3.dict_name as POSITIONAL_NAME,tab4.dict_name as level_name from sys_dict tab3 left join sys_dict tab4 on tab3.BACKUP2 = tab4.DICT_CODE
    where tab3.GROUP_NAME = 'POSITIONAL_TITLES') tb6  on tb6.DICT_CODE = t1.POSITIONAL_TITLES
    left join BASE_SERIES_PROFESSIAL tb7 on tb7.PROFESSIAL_CODE = t1.PROFESSIAL_CODE
    left join sys_dict tb8 on tb8.DICT_CODE = t1.REVIEW_TYPE and tb8.GROUP_NAME = 'REVIEW_TYPE'
    where t1.ISBUILEFILE =0 AND t1.ISBUILDCERTIFICATE = 1 and t1.JUDGING_CODE in
    (
    select JUDGING_CODE from base_judging where BACK3 = 1
    <if test="judgingId != null and judgingId !=''">
      and ID = #{judgingId}
    </if>
    <if test="manageUnitCode != null and manageUnitCode !=''">
      and MANAGE_UNIT = #{manageUnitCode}
    </if>
    )
    <if test="userName != null and userName !=''">
      and t1.USER_NAME  like '%'||#{userName}||'%'
    </if>
    <if test="yearNo != null and yearNo !=''">
      and t1.YEAR_NO = #{yearNo}
    </if>
    <if test="reviewSeries != null and reviewSeries !=''">
      and t1.REVIEW_SERIES = #{reviewSeries}
    </if>
    <if test="professialCode != null and professialCode !=''">
      and t1.PROFESSIAL_CODE = #{professialCode}
    </if>
    <if test="areaCode != null and areaCode !=''">
      and t1.AREA_CODE IN
      (select  AREA_CODE from SYS_AREA where AREA_CODE = #{areaCode} OR AREA_GRADE = '3' AND AREA_PARENTCODE = #{areaCode})
    </if>
    ORDER BY t1.YEAR_NO DESC ,t1.AREA_CODE,tb1.AREA_GRADE ,t1.GETTIME DESC
    )e
    <if test="page != null and rows != null">
      where rownum &lt;=#{rows}*#{page})f
      where  rn>(#{page}-1)*#{rows}
    </if>

  </select>

  <!--查询评审结果记录(未生成文件)个数-->
  <select id="selectCount" parameterType="pd" resultType="Integer">
    select count(*) as listcount from REC_RESULT  where ISBUILEFILE =0 AND ISBUILDCERTIFICATE = 1
    AND JUDGING_CODE in
    (
    select JUDGING_CODE from base_judging where BACK3 = 1
    <if test="judgingId != null and judgingId !=''">
      and ID = #{judgingId}
    </if>
    <if test="manageUnitCode != null and manageUnitCode !=''">
      and MANAGE_UNIT = #{manageUnitCode}
    </if>
    )
    <if test="userName != null and userName !=''">
      and USER_NAME  like '%'||#{userName}||'%'
    </if>
    <if test="yearNo != null and yearNo !=''">
      and YEAR_NO = #{yearNo}
    </if>
    <if test="reviewSeries != null and reviewSeries !=''">
      and REVIEW_SERIES = #{reviewSeries}
    </if>
    <if test="professialCode != null and professialCode !=''">
      and PROFESSIAL_CODE = #{professialCode}
    </if>
    <if test="areaCode != null and areaCode !=''">
      and AREA_CODE IN
      (select  AREA_CODE from SYS_AREA where AREA_CODE = #{areaCode} OR AREA_GRADE = '3' AND AREA_PARENTCODE = #{areaCode})
    </if>
  </select>

  <!--生成文件列表-->
  <select id="selectFileList" parameterType="pd" resultMap="BaseResultMap">
    select *
    from
    (select rownum rn,e.* from
    (
      select * from REC_FILEMANAGER  where 1 = 1
    <if test="fileTitle != null and fileTitle !=''">
      and FILE_TITLE  like '%'||#{fileTitle}||'%'
    </if>
    <if test="yearNo != null and yearNo !=''">
      and YEAR_NO = #{yearNo}
    </if>
      ORDER BY ADDTIME DESC,FILE_TITLE
    )e
    <if test="page != null and rows != null">
      where rownum &lt;=#{rows}*#{page})f
      where  rn>(#{page}-1)*#{rows}
    </if>

  </select>

  <!--查询评审结果记录(生成文件)个数-->
  <select id="selectFileListCount" parameterType="pd" resultType="Integer">
    select count(*) as listcount from REC_FILEMANAGER  where 1 = 1
    <if test="fileTitle != null and fileTitle !=''">
      and FILE_TITLE  like '%'||#{fileTitle}||'%'
    </if>
    <if test="yearNo != null and yearNo !=''">
      and YEAR_NO = #{yearNo}
    </if>
  </select>
</mapper>